_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g};window.TorrentListView=Backbone.View.extend({model:new window.Torrent,el:"#TorrentList",events:{"paste #search":"search","keyup #search":"search","click #pauseTorrent":"pauseTorrent","click #startTorrent":"startTorrent","click #removeTorrent":"removeTorrent"},alertId:0,pauseTorrent:function(){var e=this;if($("body").find(".accordion-body.in").length)$("body").find(".accordion-body.in").each(function(){var t=$(this).attr("id").substring(19);var n=e.collection.get(t);$("#ajax_loading").fadeIn(400);$.ajax({url:"/torrent/action",type:"POST",async:true,cache:false,data:{action:"pause",id:t},success:function(e,t,r){$("#ajax_loading").fadeOut(400);n.set("isPaused",true)},error:function(t,n,r){$("#ajax_loading").fadeOut(400);lastId=e.alertId;e.alertId++;errorData={id:lastId,message:n};$("#alertAria").append(e.alertTemplate.render(errorData));$(".alert").alert()}})})},search:function(){this.render();var e=$("#search").val();this.collection.search(e).forEach(this.addOne)},startTorrent:function(){var e=this;if($("body").find(".accordion-body.in").length)$("body").find(".accordion-body.in").each(function(){var t=$(this).attr("id").substring(19);var n=e.collection.get(t);$("#ajax_loading").fadeIn(400);$.ajax({url:"/torrent/action",type:"POST",async:true,cache:false,data:{action:"resume",id:t},success:function(e,t,r){$("#ajax_loading").fadeOut(400);n.set("isPaused",false)},error:function(t,n,r){$("#ajax_loading").fadeOut(400);lastId=e.alertId;e.alertId++;errorData={id:lastId,message:n};$("#alertAria").append(e.alertTemplate.render(errorData));$(".alert").alert()}})})},removeTorrent:function(){var e=this;if($("body").find(".accordion-body.in").length)$("body").find(".accordion-body.in").each(function(){var t=$(this).attr("id").substring(19);var n=e.collection.get(t);$("#ajax_loading").fadeIn(400);$.ajax({url:"/torrent/action",type:"POST",async:true,cache:false,data:{action:"remove",id:t},success:function(t,r,i){$("#ajax_loading").fadeOut(400);e.collection.remove([n])},error:function(t,n,r){$("#ajax_loading").fadeOut(400);lastId=e.alertId;e.alertId++;errorData={id:lastId,message:n};$("#alertAria").append(e.alertTemplate.render(errorData));$(".alert").alert()}})})},initialize:function(){this.alertTemplate=$.templates("#alert-view");this.model.view=this;this.collection=new window.TorrentCollection;this.paginationView=new window.PaginationView;this.paginationView.view=this;var e=this;this.collection.fetch({data:{page:1,pageSize:10},success:function(t,n,r){e.paginationView.page_count=Math.floor(n[0].torrentsCount/e.paginationView.page_show);e.paginationView.render()},error:function(t,n,r){lastId=e.alertId;e.alertId++;errorData={id:lastId,message:"Error while getting data from server"};$("#alertAria").append(e.alertTemplate.render(errorData));$(".alert").alert()}});this.listenTo(this.collection,"add",this.addOne);this.listenTo(this.collection,"remove",this.removeOne)},changePage:function(e){var t=this;$("#ajax_loading").fadeIn(400);this.collection.fetch({data:{page:e,pageSize:10},success:function(){$("#ajax_loading").fadeOut(400)},error:function(e,n,r){$("#ajax_loading").fadeOut(400);lastId=t.alertId;t.alertId++;errorData={id:lastId,message:"Error while getting data from server"};$("#alertAria").append(t.alertTemplate.render(errorData));$(".alert").alert()}})},collectionChanged:function(){this.collection.forEach(this.reRender)},reRender:function(e){var t=new window.TorrentView({model:e,listView:this});t.render();$("#torrentData"+t.model.get("id")+" a:first").tab("show");$("#torrentData"+t.model.get("id")+" a").click(function(e){e.preventDefault();$(this).tab("show")})},updateCollection:function(){var e=this;$("#ajax_loading").fadeIn(400);this.collection.fetch({data:{page:this.paginationView.page_active,pageSize:10},success:function(){$("#ajax_loading").fadeOut(400)},error:function(t,n,r){$("#ajax_loading").fadeOut(400);lastId=e.alertId;e.alertId++;errorData={id:lastId,message:"Error while getting data from server"};$("#alertAria").append(e.alertTemplate.render(errorData));$(".alert").alert()}})},removeOne:function(e){$("#torrent"+e.get("id")).parent("div").animate({opacity:0,height:"0px"},800,function(){$(this).remove()})},addOne:function(e){var t=new window.TorrentView({model:e});$("#TorrentList").append(t.render().el);$("#torrentData"+t.model.get("id")+" a:first").tab("show");$("#torrentData"+t.model.get("id")+" a").click(function(e){e.preventDefault();$(this).tab("show")})},addAll:function(){this.collection.forEach(this.addOne)},render:function(){$(this.el).html("");return this}})